# ОТЧЕТ ПО УЧЕБНОЙ ПРАКТИКЕ  
**Тема:** Разработка программного модуля для учета заявок на ремонт климатического оборудования  
**Заказчик:** ООО «Конди»  
**Исполнитель:** Сервисный центр «IT‑Сфера»  

## Цель работы
Разработать программный модуль учета заявок на ремонт климатического оборудования, обеспечивающий добавление и редактирование заявок, назначение ответственных специалистов, отслеживание статусов, ведение комментариев/комплектующих, а также расчет статистики по выполненным заявкам. Реализовать авторизацию и разграничение доступа по ролям. Провести отладку и функциональное тестирование (минимум 1 автоматизированный тест) и оформить протокол тестирования.

## 1. Постановка задачи (по ТЗ)
Необходимо реализовать:
- добавление заявок в БД с параметрами: номер, дата добавления, тип оборудования, модель, описание проблемы, ФИО, телефон, статус;
- редактирование заявки: статус/этап, описание проблемы, ответственный;
- список заявок, поиск по номеру/параметрам, уведомления о смене статуса;
- назначение специалиста, возможность специалисту вести комментарии и фиксировать заказанные комплектующие;
- расчет статистики: количество выполненных, среднее время выполнения, статистика по типам неисправностей;
- безопасность: логин/пароль, ограничение доступа по роли;
- интерфейс: единый стиль, корректные заголовки, навигация «Назад», сообщения об ошибках/предупреждениях/успехе и подтверждение перед удалением.

## 2. Выбранные средства реализации
- Язык/Back-end: Python 3 + Flask
- Хранилище: SQLite
- Front-end: HTML (Jinja2‑шаблоны) + единый CSS
- Тестирование: pytest

## 3. Краткая спецификация модуля (входные/выходные данные)

### 3.1. Роли и права
- **Администратор**: управление пользователями, доступ ко всем заявкам.
- **Оператор**: создание/редактирование заявок, назначение специалистов, просмотр уведомлений, расчет статистики.
- **Специалист**: просмотр назначенных заявок, смена статуса по своей заявке, комментарии и комплектующие, просмотр уведомлений.

### 3.2. Входные данные (формы)
- **Вход**: логин, пароль.
- **Создание заявки**: тип оборудования, модель, описание проблемы, ФИО, телефон, (опц.) специалист.
- **Редактирование заявки**: статус/этап, описание проблемы, ответственный специалист.
- **Работа по заявке**: смена статуса, комментарий, комплектующая (название, количество).
- **Поиск/фильтры**: строка поиска, статус, специалист (для оператора/админа), период дат.
- **Статистика**: период дат.

### 3.3. Выходные данные
- список заявок (с фильтрами);
- карточка заявки (данные заявки + комментарии + комплектующие + история изменений);
- уведомления (назначение/смена статуса);
- отчет статистики: количество выполненных, среднее время, распределение по типам неисправностей.

## 4. Основной алгоритм (блок‑схема)
Блок‑схема основного процесса учета заявок приведена в `docs/task1.md` (Mermaid‑схема).  
Для отчета по ГОСТ 19.701 допускается экспорт схемы в изображение и вставка как «Рисунок».

**Рисунок 1 – Блок‑схема основного алгоритма учета заявок** (вставить после экспорта).

## 5. Детализация функции (статистика)
Алгоритм расчета статистики приведен в `docs/task1.md` (Mermaid‑схема).

**Рисунок 2 – Блок‑схема функции расчета статистики** (вставить после экспорта).

## 6. Проектирование данных (SQLite)

### 6.1. Таблицы БД
Файл схемы: `app/schema.sql`.

| Таблица | Назначение | Ключевые поля |
|---|---|---|
| `users` | пользователи и роли | `id (PK)`, `username (UNIQUE)`, `password_hash`, `role`, `is_active` |
| `tickets` | заявки | `id (PK)`, `request_number (UNIQUE)`, `created_at`, `status`, `assigned_specialist_id (FK)` |
| `status_history` | история изменений статуса/ответственного | `id (PK)`, `ticket_id (FK)`, `old_status`, `new_status`, `changed_by_user_id (FK)` |
| `ticket_comments` | комментарии к заявке | `id (PK)`, `ticket_id (FK)`, `user_id (FK)`, `body` |
| `ticket_parts` | заказанные комплектующие | `id (PK)`, `ticket_id (FK)`, `part_name`, `quantity` |
| `notifications` | уведомления пользователей | `id (PK)`, `user_id (FK)`, `ticket_id (FK)`, `message`, `is_read` |

### 6.2. Ограничения целостности
- первичные ключи `id` (AUTOINCREMENT);
- внешние ключи обеспечивают ссылочную целостность;
- статусы и роли ограничены `CHECK`;
- `request_number` уникален;
- `quantity` для комплектующих ограничено `CHECK(quantity > 0)`.

## 7. Реализация (Flask)

### 7.1. Структура проекта
- `main.py` — точка входа
- `app/` — приложение Flask
  - `auth.py` — авторизация/выход, обработчики ошибок
  - `tickets.py` — заявки, комментарии, комплектующие
  - `notifications.py` — список уведомлений
  - `stats.py` — расчет статистики
  - `admin.py` — управление пользователями
  - `db.py`, `schema.sql` — работа с SQLite
  - `templates/`, `static/` — HTML/CSS
- `tests/` — автоматизированные тесты

### 7.2. Навигация и интерфейс
Все страницы построены на `base.html` с единым меню и стилем. На формах и карточках присутствуют кнопки «Назад».  
Сообщения пользователю реализованы через `flash` с типами: ошибка/предупреждение/информация/успех.

### 7.3. Обработка ошибок и исключительных ситуаций
Реализовано:
- запрет действий без авторизации (перенаправление на вход);
- запрет действий без прав (страница 403);
- обработка отсутствующих объектов (404);
- валидация обязательных полей и телефона;
- уведомления «результатов поиска нет»;
- подтверждение удаления заявки/пользователя (JS `confirm`).

### 7.4. Уведомления
Уведомления создаются при:
- назначении специалиста на заявку;
- смене статуса заявки (в том числе завершение).

## 8. Отладка
Отладка выполняется средствами IDE (PyCharm) или запуском Flask с режимом отладки.

Рекомендуемый сценарий отладки:
1) поставить breakpoint в `app/tickets.py` в обработчиках `create_ticket`, `update_status`;
2) выполнить создание заявки и смену статуса;
3) проверить записи в БД (например, через DB Browser for SQLite).

**Рисунок 3 – Отладка (breakpoint) при создании заявки** (скриншот).  
**Рисунок 4 – Просмотр таблиц SQLite после операций** (скриншот).

## 9. Тестирование
Инструмент: `pytest`.

Запуск: `pytest -q`

Покрыто:
- расчет статистики (`tests/test_statistics.py`);
- сквозной сценарий: создание заявки → комментарий/комплектующая → завершение → уведомление (`tests/test_workflow.py`).

Результаты тестирования оформлены в `docs/test_protocol_task1.md`.

## Вывод
Разработан веб‑модуль учета заявок на ремонт климатического оборудования на Flask + SQLite, реализующий требования ТЗ: создание/редактирование заявок, назначение специалистов, отслеживание статусов и уведомления, комментарии/комплектующие, расчет статистики. Реализованы обработка ошибок и разграничение доступа по ролям, выполнено функциональное тестирование с использованием pytest.

