# ОТЧЕТ — Задание 3 (модификация программного модуля)

## 1. Постановка задачи

Требуется выполнить модификацию программного модуля учета заявок на ремонт климатического оборудования по дополнению к техническому заданию:

- добавить роль **менеджера по качеству**;
- реализовать обращение специалиста за помощью при невозможности выполнения ремонта;
- реализовать возможность менеджера по качеству:
  - привлекать специалистов к выполнению ремонта;
  - продлевать срок выполнения заявки **с согласованием заказчика**;
- добавить отслеживание качества работ по отзывам;
- добавить генерацию **QR‑кода** для оценки качества (QR ведет на форму опроса заказчика);
- подготовить документацию: руководство системному программисту (ЕСПД), предложения по модификации, описание качественных характеристик кода.

Ссылка на форму обратной связи (из дополнения к ТЗ):  
`https://docs.google.com/forms/d/e/1FAIpQLSdhZcExx6LSIXxk0ub55mSu-WIh23WYdGG9HY5EZhLDo7P8eA/viewform?usp=sf_link`

## 2. Анализ дополнения к ТЗ (требования к модификации)

Из дополнения к ТЗ следует, что на этапе исполнения заявки могут возникать:
- необходимость заказа комплектующих;
- координация работ с другими специалистами;
- ситуация «ремонт не выполнен в срок»;
- потребность в консультации/помощи (специалист обращается к менеджеру по качеству).

Для реализации требований выделены новые функции системы:
- хранение срока выполнения заявки и истории его изменения;
- механизм запросов помощи специалиста и закрытия запросов менеджером;
- механизм привлечения дополнительных специалистов (помощников) к заявке;
- генерация QR‑кода и фиксация результата отзыва (оценки) в системе.

## 3. Проектирование модификации

### 3.1. Роли и доступ

Добавлена роль `manager` (Менеджер по качеству). Доступ:
- просмотр всех заявок;
- панель «Качество»: список просроченных заявок и открытых запросов помощи;
- привлечение специалистов к заявке;
- продление срока выполнения заявки (при обязательном подтверждении «согласовано с заказчиком»);
- фиксация отзыва (оценка 1–5 и комментарий).

### 3.2. Изменения структуры БД (SQLite)

Добавлено поле в заявку:
- `tickets.due_at` — срок выполнения (дата/время).

Добавлены таблицы:
- `ticket_specialists` — привлеченные специалисты к заявке;
- `ticket_due_history` — история изменений срока и факт согласования заказчика;
- `ticket_help_requests` — запросы помощи (open/resolved);
- `ticket_reviews` — фиксация оценки качества (rating 1–5 + комментарий).

## 4. Реализация модификации

### 4.1. База данных и миграция

Обновлена схема `app/schema.sql`. Реализована безопасная миграция для уже созданной БД:
- расширение CHECK‑ограничения ролей пользователей (добавление `manager`);
- добавление колонки `tickets.due_at`.

### 4.2. Функции менеджера по качеству

Реализовано:
- **Панель менеджера** `/manager/`:
  - список просроченных заявок (срок < текущего времени, статус ≠ завершена);
  - список открытых запросов помощи.
- **Привлечение специалистов**:
  - добавление/удаление помощников к заявке;
  - уведомление специалиста о привлечении.
- **Продление срока**:
  - изменение срока выполнения с обязательным подтверждением согласования заказчика;
  - запись в историю сроков + уведомление специалистов.
- **Запрос помощи**:
  - специалист, выполняющий заявку, может отправить запрос помощи менеджеру;
  - менеджер закрывает запрос с комментарием решения;
  - заявитель получает уведомление о закрытии.
- **Качество/отзывы**:
  - генерация QR‑кода, ведущего на форму опроса;
  - ручная фиксация отзыва менеджером (оценка 1–5, комментарий).

### 4.3. Установленные компоненты

Для генерации QR‑кода добавлена библиотека Python `segno` (SVG‑QR без Pillow).

## 5. Настройка и эксплуатация (кратко)

1) Установка зависимостей: `python3 -m pip install -r requirements.txt`  
2) Инициализация БД: `flask --app main init-db`  
3) Запуск: `python3 main.py`

Пользователи по умолчанию:
- `admin/admin`
- `operator/operator`
- `specialist/specialist`
- `manager/manager`

## 6. Тестирование

Для проверки работоспособности добавлены автотесты (pytest):
- запрос помощи специалиста отображается в панели менеджера;
- продление срока требует подтверждения согласования заказчика;
- QR‑эндпоинт возвращает SVG.

**Рисунок 1 – Запуск тестов pytest (вставить скриншот)**.

## 7. Скриншоты (для отчета)

В рамках отладки рекомендуется сохранить скриншоты:
- вход под менеджером и панель `/manager/`;
- карточка заявки: привлечение специалиста, продление срока, QR‑код;
- создание и закрытие запроса помощи;
- фиксация отзыва (оценка 1–5).

## Вывод

Выполнена модификация программного модуля согласно дополнению к техническому заданию: добавлена роль менеджера по качеству, реализованы запросы помощи и панель контроля, привлечение специалистов, продление сроков с согласованием заказчика, генерация QR‑кода и фиксация отзывов, а также подготовлены документы и автотесты.

