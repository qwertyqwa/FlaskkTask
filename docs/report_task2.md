# ОТЧЕТ — Задание 2 (проектирование БД и ER‑диаграммы)

## 1. Постановка задачи

Требуется спроектировать реляционную базу данных для учета заявок на ремонт климатического оборудования, обеспечить 3 нормальную форму и ссылочную целостность, представить ER‑диаграмму, создать БД и таблицы, выполнить импорт данных из файлов `import`, подготовить запросы/отчеты, выполнить резервное копирование БД, определить принцип регистрации пользователей, создать группы и уровни доступа.

## 2. Выбор платформы

Выбрана СУБД **SQLite**: проста в развертывании, поддерживает ограничения целостности (PK/FK/UNIQUE/CHECK), подходит для учебного проекта и переносима на Windows.

## 3. Проектирование ER‑модели (3НФ)

### 3.1. Основные сущности

- Пользователи и роли: `users`, `roles`
- Заказчики: `customers`
- Оборудование: `equipment_types`, `equipment_models`
- Заявки: `tickets`, справочник статусов `ticket_statuses`
- Статистика по неисправностям: справочник `fault_types` + ссылка в `tickets`
- История/детализация: `ticket_status_history`, `ticket_comments`, `parts`, `ticket_parts`

### 3.2. Нормализация

- Повторяющиеся значения вынесены в справочники (роли, статусы, типы/модели оборудования, типы неисправностей, комплектующие).
- В таблице `tickets` хранится только то, что относится к заявке; данные заказчика/оборудования — через внешние ключи.
- Комментарии/комплектующие/история статусов вынесены в отдельные таблицы, связанные с заявкой (связь 1→М).

### 3.3. ER‑диаграмма

ER‑диаграмма с атрибутами и ключами представлена в `docs/task2.md` (Mermaid `erDiagram`).

**Рисунок 1 – ER‑диаграмма БД учета заявок** (вставить экспортированное изображение диаграммы).

## 4. Реализация схемы БД и ограничений

Схема реализована в `task2/schema.sql`:
- первичные ключи `id`;
- внешние ключи с ограничениями удаления/изменения (ON DELETE RESTRICT/SET NULL/CASCADE);
- уникальные ограничения (например, `request_number`, коды статусов/ролей);
- проверки корректности (например, `quantity > 0`).

## 5. Импорт данных

Пример файлов импорта (CSV) расположен в `task2/import/`.

Команды:
- создание БД: `python3 tools/task2_manage.py init`
- импорт: `python3 tools/task2_manage.py import`

**Рисунок 2 – Импорт данных в БД (консоль/инструмент)** (вставить скриншот).

## 6. Запросы и отчеты

SQL‑запросы для отчетов размещены в `task2/queries/`, примеры:
- список заявок с присоединением заказчика/оборудования/статуса;
- свод по завершенным заявкам (количество, среднее время);
- распределение завершенных заявок по типам неисправностей;
- нагрузка по специалистам;
- комплектующие и комментарии по заявкам.

Генерация отчетов в Markdown:  
`python3 tools/task2_manage.py reports --date-from "2025-12-01 00:00:00" --date-to "2025-12-31 23:59:59"`

Результаты сохраняются в `task2/reports/`.

**Рисунок 3 – Пример сформированного отчета (task2/reports/...)** (вставить скриншот).

## 7. Резервное копирование

Backup выполняется двумя способами:
- SQL‑дамп: `python3 tools/task2_manage.py backup --format sql`
- копия файла SQLite: `python3 tools/task2_manage.py backup --format sqlite`

Файлы сохраняются в `task2/backups/`.

**Рисунок 4 – Созданный backup в папке task2/backups/** (вставить скриншот).

## 8. Регистрация пользователей, группы и уровни доступа

Принят принцип регистрации: **учетные записи создаются администратором** (корпоративная система без саморегистрации).

Группы пользователей представлены ролями в `roles` (например, `admin`, `operator`, `specialist`).

Уровни доступа:
- `admin`: управление пользователями и справочниками, полный доступ;
- `operator`: создание/редактирование заявок, назначение специалистов, просмотр отчетов;
- `specialist`: доступ к назначенным заявкам, комментарии/комплектующие, смена статуса.

В SQLite нет встроенной модели прав как в серверных СУБД, поэтому контроль доступа реализуется на уровне приложения (в нашем проекте — Flask).

## Вывод

Разработана ER‑модель учета заявок на ремонт климатического оборудования, приведенная к 3НФ и реализованная в SQLite со ссылочной целостностью. Реализованы импорт данных, набор SQL‑отчетов и резервное копирование БД, а также определены принципы регистрации пользователей и разграничения доступа по ролям.

